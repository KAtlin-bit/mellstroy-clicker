<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MellCoin - –ò–≥—Ä–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header">
        <div class="currency">
            <div class="currency-item" id="coins">ü™ô 0</div>
            <div class="currency-item" id="level">‚≠ê 1</div>
        </div>
        <div class="tap-power" id="tapPower">+1</div>
    </div>
    
    <div class="main-content">
        <div class="character-container">
            <div class="character" id="character" onclick="tap()">
                üë∂
            </div>
        </div>
        
        <div class="tap-text">–¢–∞–ø–∞–π –¥–ª—è –∑–∞—Ä–∞–±–æ—Ç–∫–∞ MellCoin!</div>
        <div class="income" id="income">üí∏ –î–æ—Ö–æ–¥: +1 MellCoin/—Ç–∞–ø</div>
        
        <div class="menu">
            <button class="menu-button" onclick="openUpgrades()">
                <div class="button-icon">üí™</div>
                –ü—Ä–æ–∫–∞—á–∫–∞
            </button>
            <button class="menu-button" onclick="openBusiness()">
                <div class="button-icon">üè†</div>
                –ë–∏–∑–Ω–µ—Å
            </button>
            <button class="menu-button" onclick="openEvolution()">
                <div class="button-icon">üëë</div>
                –≠–≤–æ–ª—é—Ü–∏–∏
            </button>
            <button class="menu-button" onclick="openAchievements()">
                <div class="button-icon">üèÜ</div>
                –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è
            </button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        let userData = JSON.parse(localStorage.getItem('mellcoin_user') || '{}');
        
        function updateUI() {
            document.getElementById('coins').textContent = `ü™ô ${userData.coins || 0}`;
            document.getElementById('level').textContent = `‚≠ê ${userData.level || 1}`;
            document.getElementById('tapPower').textContent = `+${userData.tapPower || 1}`;
            document.getElementById('income').textContent = `üí∏ –î–æ—Ö–æ–¥: +${userData.tapPower || 1} MellCoin/—Ç–∞–ø`;
        }
        
        async function tap() {
            // –ê–Ω–∏–º–∞—Ü–∏—è
            const character = document.getElementById('character');
            character.style.transform = 'scale(0.9)';
            setTimeout(() => character.style.transform = 'scale(1)', 100);
            
            // –°–æ–∑–¥–∞–µ–º –ª–µ—Ç–∞—é—â—É—é –º–æ–Ω–µ—Ç—É
            createFloatingCoin();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
            userData.coins = (userData.coins || 0) + (userData.tapPower || 1);
            userData.totalTaps = (userData.totalTaps || 0) + 1;
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ª–æ–∫–∞–ª—å–Ω–æ
            localStorage.setItem('mellcoin_user', JSON.stringify(userData));
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            try {
                await fetch('/api/tap', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ userId: userData.id })
                });
            } catch (error) {
                console.log('–û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º');
            }
            
            updateUI();
        }
        
        function createFloatingCoin() {
            const container = document.querySelector('.character-container');
            const coin = document.createElement('div');
            coin.className = 'floating-coin';
            coin.textContent = `+${userData.tapPower || 1} ü™ô`;
            coin.style.left = Math.random() * 100 + 'px';
            container.appendChild(coin);
            
            setTimeout(() => coin.remove(), 1000);
        }
        
        function openUpgrades() {
            window.location.href = 'upgrades.html';
        }
        
        function openBusiness() {
            window.location.href = 'business.html';
        }
        
        function openEvolution() {
            tg.showPopup({
                title: 'üëë –≠–≤–æ–ª—é—Ü–∏–∏ MellCoin',
                message: '–°–∫–æ—Ä–æ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã!',
                buttons: [{ type: 'ok' }]
            });
        }
        
        function openAchievements() {
            const achievements = userData.achievements || [];
            const message = achievements.length > 0 
                ? '–í–∞—à–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:\n' + achievements.join('\n')
                : '–î–æ—Å—Ç–∏–∂–µ–Ω–∏–π –ø–æ–∫–∞ –Ω–µ—Ç!';
                
            tg.showPopup({
                title: 'üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è',
                message: message,
                buttons: [{ type: 'ok' }]
            });
        }
        
        // Back button
        tg.BackButton.show();
        tg.BackButton.onClick(() => window.location.href = 'index.html');
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            if (!userData.id) {
                window.location.href = 'index.html';
                return;
            }
            updateUI();
        });
    </script>
</body>
</html>